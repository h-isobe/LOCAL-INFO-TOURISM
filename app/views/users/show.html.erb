<div class="container">
<div class="row">
  <div class="col-xs-4">
    <div class="box1">
      <div class="profile">
        <div class="profile-head">
          <h3>PROFILE</h3>
        </div>
      <table style="border:none;">
        <tr>
          <td><%= attachment_image_tag @user, :profile_image, :fill, 320, 250, format: 'jpg', fallback: "no_image.jpg" %></td>
        </tr>
        <tr>
          <td>
            <div class="profile-name">
              <h4>Name</h4>
              <i class="fas fa-user">
                <%= @user.name %>
              </i>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <div class="profile-introduction">
              <h4>Introduction</h4>
              <%= @user.introduction %>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <span class="follow">
              <%= link_to follower_path(@user) do %>
                <%= @user.follower.count %> フォロー
              <% end %>
            </div>
            <span class="follower">
              <%= link_to followed_path(@user) do %>
                <%= @user.followed.count %> フォロワー
              <% end %>
            </span>
          </td>
        </tr>
      </table>

      <% if @user == current_user %>
        <%= link_to "編集", edit_user_path(@user) %>
      <% else %>
        <% unless @user == current_user %>
          <% if current_user.following(@user) %>
            <%= link_to 'フォロー外す', unfollow_path(@user), method: :post, class: "btn btn-primary" %>
          <% else %>
            <%= link_to 'フォローする', follow_path(@user), method: :post, class: "btn btn-primary" %>
          <% end %>
        <% end %>
      <% end %>

      <!--チャット-->
      <span class="chat-room">
      <% unless @user.id == current_user.id %>
        <% if @isRoom == true %>
          <span class="user-show-room"><a href="/rooms/<%= @roomId %>" class="btn btn-info">チャットへ</a></span>
        <% else %>
          <%= form_for @room do |f| %>
            <%= fields_for @entry do |e| %>
              <%= e.hidden_field :user_id, value: @user.id %>
            <% end %>
            <%= f.submit "チャットを始める", class:"btn btn-info user-show-chat"%>
          <% end %>
        <% end %>      
      <% end %>
      </span>
      
      </div>
    </div>
  </div>

  <div class="col-xs-8">
    <% @posts.each do |post| %>
    <div class="box1">
      <div class="post">
        <div class="post-head">
          <h3>POST</h3>
        </div>
          <div class="row">
            <div class="col-xs-3">
            <div class="post-list">
              <%= attachment_image_tag post.user, :profile_image, :fill, 150, 100, format: 'jpg', fallback: "no_image.jpg" %>
            </div>
            </div>
            <div class="col-xs-9">
            <div class="post-list">
              投稿者：
              <i class="fas fa-user">
                <%= post.user.name %>
              </i>
            </div>
          
            <div class="post-list">
              タイトル：
              <%= link_to post_path(post) do %>
                <%= post.title %>
              <% end %>
            </div>
          
            <div class="post-list">
              場所：
              <%= post.prefecture %>
            </div>
          
            <div class="post-list">
              カテゴリー：
              <% post.categories.each do |category| %>
                <%= category.name %>
              <% end %>
            </div>
            </div>
          </div>

            <div class="post-text">
              <%= simple_format(post.body.gsub!(/[#＃][\w\p{Han}ぁ-ヶｦ-ﾟー]+/, "")) %>
              <% if post.hashtags.any? %>
                <% post.hashtags.each do |hashtag| %>
                  <span>
                    <%= link_to hashtag_path(post,hashname: hashtag.hashname) do %>
                      #<%= hashtag.hashname %>
                    <% end %>
                  </span>
                <% end %>
              <% end %>
            </div>
          
            <div class="post-image">
		          <% if post.post_images.present? %>
                <% post.post_images.each do |image| %>
                  <%= attachment_image_tag image, :image, :fill, 357, 300 %>
                <% end %>
              <% end %>
	          
          </div>
        
            <span class="favorite-count">
              <span class="post_<%= post.id %>">
                <%= render 'favorites/favorite', post: post %>
              </span>
	          </span>

            <span class="comment-count">
            <%= link_to post_path(post.id) do %>
              <i class="fa fa-comment"></i>
              <%= post.post_comments.count %>
            <% end %>
            </span>

            <span class="look-count">
            <% if post.user == current_user %>
            <i class="far fa-eye"></i>
            <%= post.impressionist_count %>
            <% end %>
            </span>

            <span class="date">
              <i class="far fa-calendar-alt">
                <%= l post.created_at %>
              </i>
            </span>
          
      </div>
    </div>
    <% end %>
    <%= paginate @posts %>
  </div>
</div>
</div>